# SafePrompt - ComfyUIçš„AIæç¤ºè¯æ¸…æ´—èŠ‚ç‚¹

è¿™æ˜¯ä¸€ä¸ªä¸º [ComfyUI](https://github.com/comfyanonymous/ComfyUI) è®¾è®¡çš„è‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œå®ƒåˆ©ç”¨æ™ºè°±AIï¼ˆZhipu AIï¼‰çš„å¼ºå¤§è¯­è¨€æ¨¡å‹ï¼Œæ ¹æ®æ‚¨æä¾›çš„è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œæ™ºèƒ½åœ°æ¸…æ´—ã€ä¼˜åŒ–æˆ–é‡å†™æ‚¨çš„æç¤ºè¯ï¼ˆPromptï¼‰ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **AIé©±åŠ¨çš„æ–‡æœ¬å¤„ç†**: ä¸ä»…ä»…æ˜¯ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œå®ƒèƒ½ç†è§£æ‚¨çš„æ„å›¾å¹¶è¿›è¡Œæ™ºèƒ½ä¿®æ”¹ã€‚
- **çµæ´»çš„æŒ‡ä»¤**: æ‚¨å¯ä»¥é€šè¿‡ç®€å•çš„æŒ‡ä»¤ï¼ˆå¦‚â€œåˆ é™¤æ‰€æœ‰NSFWå†…å®¹â€ã€â€œå°†é£æ ¼æ”¹ä¸ºèµ›åšæœ‹å…‹â€ã€â€œç¿»è¯‘æˆè‹±æ–‡â€ï¼‰æ¥æ§åˆ¶å¤„ç†è¿‡ç¨‹ã€‚
- **æ¨¡å‹å¯é€‰**: æ”¯æŒå¤šç§æ™ºè°±AIæ¨¡å‹ï¼ŒåŒ…æ‹¬ `glm-4.5-flash`, `glm-4.5`, å’Œ `glm-z1-flash`ç­‰ã€‚
- **å®‰å…¨é…ç½®**: APIå¯†é’¥é€šè¿‡ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œä¸ä¼šæš´éœ²åœ¨å·¥ä½œæµæˆ–èŠ‚ç‚¹ç•Œé¢ä¸Šã€‚

---

## ğŸš€ å®‰è£…æŒ‡å—

1. **è·å–èŠ‚ç‚¹æ–‡ä»¶**

   - é€šè¿‡ `git clone` æˆ–ç›´æ¥ä¸‹è½½ZIPåŒ…çš„æ–¹å¼ï¼Œå°†æœ¬ä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ã€‚
2. **æ”¾ç½®èŠ‚ç‚¹**

   - å°† `SafePrompt` æ–‡ä»¶å¤¹å®Œæ•´åœ°æ”¾å…¥ ComfyUI çš„è‡ªå®šä¹‰èŠ‚ç‚¹ç›®å½•ä¸­ï¼š
     ```bash
     ComfyUI/custom_nodes/
     ```
3. **å®‰è£…ä¾èµ–**

   - æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œå·¥å…·ï¼‰ï¼Œè¿›å…¥ `SafePrompt` ç›®å½•ï¼š
     ```bash
     cd ComfyUI/custom_nodes/SafePrompt
     ```
   - å®‰è£…æ‰€éœ€çš„Pythonåº“ï¼š
     ```bash
     pip install -r requirements.txt
     ```
4. **é…ç½®APIå¯†é’¥**

   - åœ¨ `SafePrompt` æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰¾åˆ° `config.json.example` æ–‡ä»¶ã€‚
   - **å¤åˆ¶**è¯¥æ–‡ä»¶å¹¶å°†å…¶**é‡å‘½å**ä¸º `config.json`ã€‚
   - ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ `config.json`ï¼Œå°† `"YOUR_ZHIPU_API_KEY_HERE"` æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„æ™ºè°±AI APIå¯†é’¥ã€‚
5. **é‡å¯ComfyUI**

   - å…³é—­å¹¶é‡æ–°å¯åŠ¨ComfyUIã€‚æ‚¨ç°åœ¨åº”è¯¥å¯ä»¥åœ¨èŠ‚ç‚¹èœå•ä¸­æ‰¾åˆ°å®ƒã€‚

---

## ğŸ“ å¦‚ä½•ä½¿ç”¨

1. **æ·»åŠ èŠ‚ç‚¹**: åœ¨ComfyUIçš„èŠ‚ç‚¹èœå•ä¸­ï¼Œé€‰æ‹© `SafePrompt` -> `SafePrompt` å³å¯å°†èŠ‚ç‚¹æ·»åŠ åˆ°æ‚¨çš„å·¥ä½œæµä¸­ã€‚
2. **è¿æ¥è¾“å…¥**:

   - `prompt`: è¿æ¥æ‚¨æƒ³è¦å¤„ç†çš„åŸå§‹æç¤ºè¯ã€‚è¿™å¯ä»¥æ¥è‡ªä¸€ä¸ªâ€œPrimitiveâ€èŠ‚ç‚¹æˆ–ä»»ä½•å…¶ä»–è¾“å‡ºæ–‡æœ¬çš„èŠ‚ç‚¹ã€‚
   - `instruction`: åœ¨æ­¤æ–‡æœ¬æ¡†ä¸­è¾“å…¥æ‚¨å¸Œæœ›AIæ‰§è¡Œçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼šâ€œè¯·æŠŠæ‰€æœ‰å…³äºçŒ«çš„æè¿°éƒ½æ¢æˆç‹—â€ã€‚
   - `model`: ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸€ä¸ªAIæ¨¡å‹ã€‚
   - `seed`: éšæœºç§å­ï¼Œç”¨äºç¡®ä¿AIåœ¨åŒæ ·è¾“å…¥ä¸‹èƒ½äº§ç”Ÿå¯å¤ç°çš„ç»“æœã€‚
3. **è·å–è¾“å‡º**:

   - `cleaned_prompt`: æ­¤è¾“å‡ºç«¯å£å°†æä¾›ç»è¿‡AIå¤„ç†åçš„ã€å¹²å‡€çš„æç¤ºè¯ã€‚æ‚¨å¯ä»¥å°†å…¶è¿æ¥åˆ°ä»»ä½•éœ€è¦æç¤ºè¯è¾“å…¥çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚KSamplerã€‚

### ç¤ºä¾‹å·¥ä½œæµ

```
[Primitive String] -> [SafePrompt] -> [CLIP Text Encode]
      (prompt)    ->  (prompt)      (cleaned_prompt)

[Primitive String] ->  (instruction)
   (instruction)
```

---

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼
